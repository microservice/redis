omg: 1
lifecycle:
  startup:
    command: ["/bin/sh", "/app/start.sh"] 
info:
  version: 1.0.1
  title: Redis
  description: This is a redis service
volumes:
  db:
    target: /db
    persist: true
health:
  http:
    path: /health
    port: 8000
actions:
  set: &key_value_required
    http: &http
      path: /set
      port: 8000
      method: post
      contentType: application/json
    arguments:
      key: &key
        type: string
        in: requestBody
        required: true
      value: &value
        type: any
        in: requestBody
        required: true
    output:
      type: none
  rpush:
    <<: *key_value_required
    http:
      <<: *http
      path: /rpush
  lpush:
    <<: *key_value_required
    http:
      <<: *http
      path: /lpush
  lpop: &key_required
    http:
      <<: *http
      path: /lpop
    arguments:
      key:
        <<: *key
    output:
      type: any
  rpop:
    <<: *key_required
    http:
      <<: *http
      path: /rpop
    output:
      type: any
  blpop:
    <<: *key_required
    http:
      <<: *http
      path: /blpop
    output:
      type: any
  brpop:
    <<: *key_required
    http:
      <<: *http
      path: /brpop
    output:
      type: any
  del:
    <<: *key_required
    http:
      <<: *http
      path: /del
    output:
      type: none
  get:
    <<: *key_required
    http:
      <<: *http
      path: /get
    output:
      type: string
  mget:
    http:
      <<: *http
      path: /get
    arguments:
      keys:
        in: requestBody
        type: list
    output:
      type: lisy
  incr:
    http:
      <<: *http
      path: /incr
    arguments:
      key:
        <<: *key
      by:
        in: requestBody
        type: any
    output:
      type: string
  append:
    http:
      <<: *http
      path: /append
    arguments:
      key:
        <<: *key
      value:
        in: requestBody
        type: any
    output:
      type: int
  getSet:
    http:
      <<: *http
      path: /getset
    arguments:
      key:
        <<: *key
      value:
        in: requestBody
        type: any
    output:
      type: string
  setnx:
    http:
      <<: *http
      path: /setnx
    arguments:
      key:
        <<: *key
      value:
        in: requestBody
        type: any
    output:
      type: boolean
  mset:
    http:
      <<: *http
      path: /mset
    arguments:
      pairs:
        in: requestBody
        type: map
    output:
      type: none
  msetnx:
    http:
      <<: *http
      path: /msetnx
    arguments:
      pairs:
        in: requestBody
        type: map
    output:
      type: boolean
  expire:
    http:
      <<: *http
      path: /expire
    arguments:
      key:
        <<: *key
      seconds:
        in: requestBody
        type: int
        required: true
    output:
      type: none
  listener:
    events:
      rpop:
        help: RPOP a key constantly, and emit the values as events
        http: &rpop_http
          port: 8000
          subscribe:
            path: /listener/add
            method: post
          unsubscribe:
            path: /listener/remove
            method: post
        arguments:
          key:
            type: string
            required: true
            in: requestBody
            help: The key to RPOP
        output:
          type: any
      lpop:
        help: LPOP a key constantly, and emit the values as events
        http:
          <<: *rpop_http
        arguments:
          key:
            type: string
            required: true
            in: requestBody
            help: The key to LPOP
        output:
          type: any

environment:
  REDIS_HOST:
    type: string
  REDIS_PORT:
    type: int
  REDIS_DB:
    type: string
  REDIS_PASSWORD:
    type: string
